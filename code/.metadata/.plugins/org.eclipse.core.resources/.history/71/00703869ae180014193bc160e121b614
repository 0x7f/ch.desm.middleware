package ch.desm.middleware.modules.communication.endpoint.serial.ubw32;

import ch.desm.middleware.modules.core.daemon.DaemonThread;

/**
 * Inherits the Daeon class to execute polling sequence
 * @author Sebastian
 *
 */
class EndpointUbw32Polling extends DaemonThread {

	private EndpointUbw32 endpoint;
	private int waitTimeMs;
	
	EndpointUbw32Polling(EndpointUbw32 endpoint, int waitTimeMs) {
		super("EndpointUbw32Polling (" + endpoint.getSerialPortName()+")");
		this.endpoint = endpoint;
		this.waitTimeMs = waitTimeMs;
	}

	
	public void sendStateCommand(){
		
		if(endpoint.isConfigurationDigitalAvailable()){
			endpoint.sendCommandInputState();
		}
		
		if(endpoint.isPinBitMaskAnalogAvailable()){
			endpoint.sendCommandInputAnalog(endpoint.getPinBitMaskInputAnalog());
			
		}
	}
	
	
	@Override
	/**
	 * TODO refactoring sleep
	 */
	public void run() {

		try {
			while (!isInterrupted()) {
				
				sendStateCommand();				
				Thread.sleep(waitTimeMs);
			}
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
	}
}

package ch.desm.middleware.modules.communication.endpoint.virtual;

import java.util.Hashtable;

import org.apache.log4j.Logger;

import ch.desm.middleware.modules.core.daemon.DaemonThread;

class EndpointInterlockingLogicPolling extends DaemonThread {

	protected static Logger log = Logger.getLogger(EndpointInterlockingLogicPolling.class);
	
	private EndpointInterlockingPetriNet net;
	private Hashtable<String, Boolean> map;
	String transition;
	Boolean value;
	boolean isChanged;
	
	public EndpointInterlockingLogicPolling(String name, EndpointInterlockingPetriNet net) {
		super(name);
		this.map = new Hashtable<String, Boolean>();
		this.net = net;
		
		net.writeActors();
		net.init();
		
		this.start();
	}
	
	/**
	 * 
	 */
	@Override
	public void run() {
		while (!isInterrupted()) {
			  Boolean value = net.fireOneTransition();
			  String key = net.getFiredElement();
			  isChanged = false;
			  
			  if(!this.transition.equals(key)){
				  this.transition = key;
				  isChanged = true;
			  }
			  if(!this.value.equals(value)){
				  this.value= value;
				  isChanged = true;
			  }
			  
			  
			  map.put(key, value);
			  log.info("key: " +key+ ", value: " + value);
		}
	}

}
